<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="860" viewBox="0 0 1400 860" version="1.1">
  <!-- Updated: 2024-12-19 15:35 with blue arrows and complete flow -->
  <defs>
    <!-- Background gradient -->
    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f8fafc;stop-opacity:1" />
      <stop offset="50%" style="stop-color:#f1f5f9;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e2e8f0;stop-opacity:1" />
    </linearGradient>
    
    <!-- Subtle grid pattern -->
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e2e8f0" stroke-width="0.5" opacity="0.3"/>
    </pattern>
    
    <!-- Box shadow filter -->
    <filter id="dropshadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="4" stdDeviation="3" flood-color="#000000" flood-opacity="0.1"/>
    </filter>
    
    <!-- Soft glow filter -->
    <filter id="softglow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge> 
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <style>
      .box { fill:#ffffff; stroke:#e2e8f0; stroke-width:2; rx:8; ry:8; filter:url(#dropshadow); }
      .group { fill:#ffffff; stroke:#cbd5e1; stroke-dasharray:6 4; rx:12; ry:12; filter:url(#dropshadow); }
      .lbl { font: 14px/1.3 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; fill:#1e293b; }
      .muted { fill:#64748b; font: 12px/1.3 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
      .title { font: 600 16px/1.3 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; fill:#0f172a; }
      .small { font: 12px/1.3 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; fill:#1e293b; }
      .arrow { stroke:#3b82f6; stroke-width:2.5; fill:none; marker-end:url(#arrow); }
      .arrow-muted { stroke:#94a3b8; stroke-width:2; fill:none; marker-end:url(#arrow-muted); }
      .cap { stroke-linecap:round; }
      .pill { fill:#f8fafc; stroke:#cbd5e1; stroke-width:1.5; rx:10; ry:10; filter:url(#dropshadow); }
      .note { fill:#eff6ff; stroke:#93c5fd; stroke-width:1.5; rx:8; ry:8; filter:url(#dropshadow); }
    </style>
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#3b82f6"/>
    </marker>
    <marker id="arrow-muted" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="860" fill="url(#bgGradient)"/>
  <rect width="1400" height="860" fill="url(#grid)"/>
  
  <!-- Decorative background elements -->
  <circle cx="1200" cy="100" r="60" fill="#f0f9ff" opacity="0.3"/>
  <circle cx="200" cy="700" r="40" fill="#fef3c7" opacity="0.2"/>
  <circle cx="1300" cy="600" r="80" fill="#f3e8ff" opacity="0.2"/>

  <!-- Row 1: Request, Route, Middleware, Form Request -->
  <rect x="40" y="40" width="200" height="66" class="box"/>
  <text x="140" y="64" text-anchor="middle" class="title">HTTP Request</text>
  <text x="140" y="84" text-anchor="middle" class="muted">(GET / POST / etc)</text>

  <rect x="300" y="48" width="160" height="50" class="box"/>
  <text x="380" y="78" text-anchor="middle" class="lbl">Route</text>

  <rect x="520" y="48" width="180" height="50" class="box"/>
  <text x="610" y="78" text-anchor="middle" class="lbl">Middleware</text>

  <rect x="760" y="48" width="190" height="50" class="box"/>
  <text x="855" y="68" text-anchor="middle" class="lbl">Form Request</text>
  <text x="855" y="88" text-anchor="middle" class="muted">(validation / authz)</text>

  <!-- Arrows row 1 - HTTP flow -->
  <line x1="240" y1="73" x2="300" y2="73" class="arrow cap"/>
  <line x1="460" y1="73" x2="520" y2="73" class="arrow cap"/>
  <line x1="700" y1="73" x2="760" y2="73" class="arrow cap"/>

  <!-- Form Request to Controller -->
  <line x1="855" y1="98" x2="610" y2="140" class="arrow cap"/>

  <!-- Controller -->
  <rect x="520" y="140" width="180" height="60" class="box"/>
  <text x="610" y="168" text-anchor="middle" class="title">Controller</text>
  <text x="610" y="188" text-anchor="middle" class="muted">(coordina / delega)</text>

  <!-- Controller -> Service -->
  <line x1="610" y1="200" x2="610" y2="242" class="arrow cap"/>

  <!-- Service Layer group -->
  <rect x="400" y="244" width="420" height="96" class="group"/>
  <text x="610" y="266" text-anchor="middle" class="title">Service Layer</text>
  <text x="610" y="286" text-anchor="middle" class="muted">(Business Logic)</text>

  <!-- Service inner box -->
  <rect x="436" y="300" width="160" height="40" class="box"/>
  <text x="516" y="325" text-anchor="middle" class="lbl">Service</text>

  <!-- Service emits domain event -->
  <rect x="616" y="300" width="180" height="40" class="pill note"/>
  <text x="706" y="323" text-anchor="middle" class="small">Emette Evento (Dominio)</text>

  <line x1="596" y1="320" x2="616" y2="320" class="arrow-muted cap"/>

  <!-- Domain Listener and Other Services -->
  <rect x="860" y="290" width="140" height="40" class="box"/>
  <text x="930" y="315" text-anchor="middle" class="lbl">Listener</text>

  <rect x="860" y="340" width="140" height="40" class="box"/>
  <text x="930" y="365" text-anchor="middle" class="lbl">Altri Service</text>

  <path d="M 796 320 C 820 320 830 310 860 310" class="arrow-muted"/>

  <!-- Service -> Data Layer -->
  <line x1="516" y1="340" x2="516" y2="400" class="arrow cap"/>

  <!-- Data Layer group -->
  <rect x="360" y="402" width="500" height="120" class="group"/>
  <text x="610" y="424" text-anchor="middle" class="title">Data Layer</text>
  <text x="610" y="444" text-anchor="middle" class="muted">Model / Repository</text>

  <!-- Data Layer inner box -->
  <rect x="436" y="454" width="180" height="44" class="box"/>
  <text x="526" y="480" text-anchor="middle" class="lbl">Model / Repo</text>

  <!-- Data emits data event -->
  <rect x="646" y="454" width="210" height="44" class="pill note"/>
  <text x="751" y="480" text-anchor="middle" class="small">Emette Evento (Dati)</text>

  <line x1="616" y1="476" x2="646" y2="476" class="arrow-muted cap"/>

  <!-- Data Listener and Other Services -->
  <rect x="900" y="446" width="140" height="40" class="box"/>
  <text x="970" y="470" text-anchor="middle" class="lbl">Listener</text>

  <rect x="900" y="496" width="140" height="40" class="box"/>
  <text x="970" y="520" text-anchor="middle" class="lbl">Altri Service</text>

  <path d="M 856 476 C 876 476 884 466 900 466" class="arrow-muted"/>

  <!-- Data -> Output Layer -->
  <line x1="526" y1="498" x2="526" y2="564" class="arrow cap"/>

  <!-- Output Layer group -->
  <rect x="320" y="566" width="580" height="110" class="group"/>
  <text x="610" y="588" text-anchor="middle" class="title">Output Layer</text>
  <text x="610" y="608" text-anchor="middle" class="muted">(Resource / Blade / Redirect)</text>

  <!-- Output options -->
  <rect x="356" y="620" width="170" height="44" class="box"/>
  <text x="441" y="646" text-anchor="middle" class="lbl">Resource</text>

  <rect x="546" y="620" width="170" height="44" class="box"/>
  <text x="631" y="646" text-anchor="middle" class="lbl">Blade</text>

  <rect x="736" y="620" width="144" height="44" class="box"/>
  <text x="808" y="646" text-anchor="middle" class="lbl">Redirect</text>

  <!-- Back to Response -->
  <line x1="441" y1="664" x2="441" y2="710" class="arrow cap"/>
  <line x1="631" y1="664" x2="631" y2="710" class="arrow cap"/>
  <line x1="808" y1="664" x2="808" y2="710" class="arrow cap"/>

  <!-- HTTP Response -->
  <rect x="420" y="712" width="420" height="72" class="box"/>
  <text x="630" y="738" text-anchor="middle" class="title">HTTP Response</text>
  <text x="630" y="760" text-anchor="middle" class="muted">(JSON / HTML / Status Code)</text>

  <!-- Side note: Controller delegates -->
  <rect x="980" y="136" width="320" height="80" class="pill"/>
  <text x="1140" y="162" text-anchor="middle" class="small">Il Controller non contiene logica di business</text>
  <text x="1140" y="182" text-anchor="middle" class="small">Innesca e delega a Service / Data / Output</text>
  <path d="M 980 176 C 900 176 820 176 700 176" class="arrow-muted"/>


</svg>
